# Core v5.4.7
**Release Date:** August 31, 2025  
**Tags:** BUG FIXES, WEBSOCKET IMPROVEMENTS, LIVE CHAT, UI ENHANCEMENTS

## Bug Fixes

### Live Chat System
#### WebSocket Message Routing
- **Fixed** WebSocket messages not reaching handleMessage functions in live chat components
- **Resolved** stream key mismatch where support ticket messages used "default" instead of proper ticket-based routing
- **Enhanced** WebSocket manager to handle support ticket message routing with special handling for `method: "reply"` and `method: "update"`
- **Implemented** automatic stream key generation: `ticket-${data.payload.id}` for proper message routing

#### Message Display Issues
- **Fixed** "Encountered two children with the same key" React warnings caused by duplicate message IDs
- **Resolved** messages using ticket/session ID instead of unique message IDs
- **Corrected** message ID generation to prioritize `replyData.message.id` over ticket ID
- **Added** fallback unique ID generation with timestamp and random string for missing message IDs

#### Message Content Processing
- **Fixed** WebSocket messages not displaying content properly due to field priority issues
- **Corrected** message content extraction to prioritize `text` field over `content` field in WebSocket payloads
- **Resolved** messages appearing blank when sent from admin to user or vice versa
- **Enhanced** message parsing to handle both legacy and current message formats

### Admin Support Interface
#### Auto-Scroll Functionality
- **Added** missing auto-scroll to bottom functionality in admin chat drawer
- **Implemented** `messagesEndRef` and `scrollToBottom()` function for consistent behavior
- **Added** automatic scrolling when new messages arrive in both mobile and desktop views
- **Enhanced** user experience with smooth scrolling to show latest messages

## Performance Improvements

### WebSocket Management
#### Message Processing
- **Optimized** WebSocket message routing by removing excessive debug logging
- **Improved** callback execution performance with cleaner error handling
- **Enhanced** subscription management with better stream key matching
- **Reduced** console noise while maintaining essential error logging

### React Component Optimization
#### Message Rendering
- **Eliminated** React key duplication warnings that could impact performance
- **Improved** message list rendering with unique keys for each message
- **Enhanced** message deduplication logic to prevent duplicate messages in UI
- **Optimized** component re-rendering with proper message ID management

## Technical Improvements

### WebSocket Architecture
#### Message Format Handling
- **Enhanced** WebSocket manager to support multiple message formats
- **Added** special handling for support ticket messages without breaking existing functionality
- **Implemented** backward compatibility for messages with existing `stream` property
- **Improved** error handling for malformed WebSocket messages

#### Subscription Management
- **Refined** subscription setup and cleanup processes
- **Added** proper connection status tracking for live chat connections
- **Enhanced** message queue processing for reliable message delivery
- **Improved** reconnection handling for stable chat experience

### Code Quality
#### Message Processing Logic
- **Standardized** message ID generation across all chat components
- **Unified** message content extraction logic between user and admin interfaces
- **Improved** type safety in message handling functions
- **Enhanced** error boundaries around WebSocket message processing

## UI/UX Improvements

### Live Chat Experience
#### User Interface
- **Enhanced** message display consistency between user and admin interfaces
- **Improved** real-time message delivery with proper WebSocket routing
- **Added** smooth auto-scrolling for better conversation flow
- **Fixed** message duplication issues that could confuse users

#### Admin Dashboard
- **Added** missing auto-scroll functionality matching user-side behavior
- **Improved** message visibility with proper scroll management
- **Enhanced** responsive design for both mobile and desktop chat views
- **Fixed** message display issues in support ticket drawers