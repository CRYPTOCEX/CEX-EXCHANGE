# Core v5.4.6
**Release Date:** August 28, 2025  
**Tags:** BUG FIXES, SECURITY, UI IMPROVEMENTS, EMAIL ENHANCEMENTS, KYC IMPROVEMENTS, BLOG MANAGEMENT

## Bug Fixes

### KYC Verification Services
#### Verification Service Errors
- **Fixed** TypeError "Cannot read properties of undefined (reading 'length')" when accessing verification services
- **Added** proper null checks and defensive programming for missingEnvVars
- **Resolved** undefined access errors with proper initialization

#### Dark Mode Support
- **Fixed** unreadable alert colors in dark mode across all verification service alerts
- **Enhanced** color contrast for better visibility in dark theme
- **Improved** text readability with proper dark mode utility classes

#### DeepSeek Integration
- **Restored** DeepSeek verification service functionality
- **Added** checkDeepSeekEnv() function for environment variable validation
- **Implemented** checkDeepSeekConnection() with proper rate limit handling
- **Fixed** rate limit (429) responses to correctly indicate valid API key
- **Created** two verification templates for DeepSeek service:
  - Document Verification template for AI-powered document analysis
  - Enhanced AI Verification template with comprehensive fraud detection

#### TypeScript Errors
- **Fixed** "Cannot find name 'User'" error in kyc.ts
- **Added** User interface definition with proper type declarations

### System Settings
#### Initialization Issues
- **Fixed** settings showing as disabled until value change
- **Simplified** initial state management for draftSettings
- **Corrected** useEffect conditions for proper setting updates
- **Enhanced** Switch component boolean value handling for "1" and 1 values

### Binary Options
#### Trading Pair Configuration
- **Fixed** "Error configuring trading pair" with missing metadata
- **Implemented** complete PUT endpoint with OpenAPI documentation
- **Added** request body validation using BinaryMarketUpdateSchema
- **Corrected** updateRecord function signature usage

### Email System
#### Sender Configuration
- **Added** APP_EMAIL_SENDER_NAME environment variable support
- **Implemented** formatted sender display: "Sender Name <email@address.com>"
- **Updated** all email providers (SMTP, Service, SendGrid, Local)
- **Fixed** hard-coded "no-reply" sender issue

#### Template Design
- **Redesigned** email template with modern gradient header
- **Added** animated background pattern for visual appeal
- **Implemented** professional typography with system fonts
- **Enhanced** layout with proper spacing and visual hierarchy
- **Added** support for:
  - Code blocks with syntax highlighting styles
  - Info cards for important messages
  - Alert styles (success, warning, error, info)
- **Implemented** responsive design for all devices
- **Added** dark mode support for compatible email clients
- **Improved** footer with Help Center, Contact, Privacy, and Terms links

### Blog Management
#### Post Creation
- **Fixed** "resource not found" error when creating blog posts
- **Resolved** status enum mismatch by removing invalid "TRASH" status
- **Corrected** author creation schema issues:
  - Separated authorCreateSchema (with userId) from authorUpdateSchema (status only)
  - Fixed schema validation for POST endpoint
  - Updated endpoint to use correct schema

## Performance Improvements

### State Management
#### Settings Page Optimization
- **Optimized** initialization patterns reducing unnecessary re-renders
- **Improved** useEffect dependencies for better performance
- **Simplified** state update logic in settings components

### Error Handling
#### Resilience Improvements
- **Added** error boundaries across multiple components
- **Implemented** graceful fallbacks for missing data
- **Enhanced** retry mechanisms with exponential backoff

## Technical Improvements

### Code Quality
#### TypeScript Enhancements
- **Resolved** multiple TypeScript errors across modules
- **Added** proper interface definitions where missing
- **Improved** type safety in API endpoints

#### Schema Validation
- **Fixed** request/response schema inconsistencies
- **Aligned** database models with API schemas
- **Improved** validation error messages

### API Documentation
#### OpenAPI Improvements
- **Added** missing metadata to multiple endpoints
- **Enhanced** permission checks across blog and binary options
- **Improved** endpoint descriptions and examples

## UI/UX Improvements

### Dark Mode Enhancements
- **Fixed** color contrast issues system-wide
- **Improved** readability in all dark mode components
- **Added** proper theme detection and switching

### User Experience
- **Enhanced** error messages with actionable retry options
- **Improved** loading states with skeleton screens
- **Added** success feedback for user actions
- **Implemented** form resilience for missing optional data

## Configuration Updates

### Environment Variables
- **Added** APP_EMAIL_SENDER_NAME to .env.example
- **Updated** email configuration documentation
- **Enhanced** environment variable validation

### Database Schema
- **Aligned** enum values between models and schemas
- **Fixed** foreign key constraints in blog tables
- **Improved** cascade delete operations

## Technical Details

### Files Modified

#### Frontend
##### KYC Module
- `frontend/app/[locale]/(dashboard)/admin/crm/kyc/components/level-builder/verification-services-view.tsx`
  - Added null checks and error handling
  - Implemented dark mode colors
  - Added DeepSeek templates

- `frontend/utils/kyc.ts`
  - Added User interface definition

##### Settings
- `frontend/app/[locale]/(dashboard)/admin/system/settings/page.tsx`
  - Fixed initialization logic
  - Improved state management

- `frontend/app/[locale]/(dashboard)/admin/system/settings/components/field.tsx`
  - Enhanced boolean handling

#### Backend
##### Binary Options
- `backend/src/api/admin/finance/binary/market/[id]/index.put.ts`
  - Added complete endpoint implementation
  - Fixed updateRecord usage

##### Email System
- `backend/src/utils/mailer.ts`
  - Added sender name configuration
  - Updated all provider implementations

- `backend/email/templates/generalTemplate.html`
  - Complete template redesign
  - Added responsive styles

##### Blog Management
- `backend/src/api/admin/blog/post/utils.ts`
  - Fixed status enum values

- `backend/src/api/admin/blog/author/utils.ts`
  - Separated create and update schemas

- `backend/src/api/admin/blog/author/index.post.ts`
  - Updated to use correct schema

##### KYC Services
- `backend/src/api/admin/crm/kyc/service/[id]/check-env.get.ts`
  - Added DeepSeek support

- `backend/src/api/admin/crm/kyc/service/[id]/check-connection.get.ts`
  - Implemented rate limit handling

## Impact
- **KYC administrators** can now properly configure and test verification services
- **Content creators** can create blog posts without schema errors
- **System administrators** see settings values immediately on page load
- **Email recipients** receive professionally formatted emails with proper sender identification
- **Overall system** stability improved with comprehensive error handling

## Migration Notes
- Add APP_EMAIL_SENDER_NAME to your .env file for custom email sender names
- No database migrations required
- All changes are backward compatible
- Updates take effect immediately after deployment

## Support
For issues or questions regarding these fixes, please refer to the documentation or contact support.